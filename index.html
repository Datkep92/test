<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý Kinh doanh</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f9f9f9; }
    .nav { display: flex; justify-content: space-between; align-items: center; background: #333; padding: 10px; color: white; }
    .nav a { color: white; text-decoration: none; }
    .section { margin: 20px 0; background: white; padding: 15px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .section h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    button { padding: 5px 10px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 3px; }
    button:hover { background: #45a049; }
    .summary p { margin: 5px 0; font-weight: bold; }
    .filter { margin: 10px 0; }
    .action-btn { background: #ff4444; }
    .action-btn:hover { background: #cc0000; }
    input[type="text"], input[type="password"] { padding: 5px; margin: 5px 0; }
  </style>
  <!-- Thêm SDK Firebase qua CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
  <script>
    // Cấu hình Firebase từ dự án quanly-d7e54
    const firebaseConfig = {
      apiKey: "AIzaSyDmFpKa8TpDjo3pQADaTubgVpDPOi-FPXk",
      authDomain: "quanly-d7e54.firebaseapp.com",
      databaseURL: "https://quanly-d7e54-default-rtdb.firebaseio.com",
      projectId: "quanly-d7e54",
      storageBucket: "quanly-d7e54.firebasestorage.app",
      messagingSenderId: "482686011267",
      appId: "1:482686011267:web:f2fe9d400fe618487a98b6"
    };

    // Khởi tạo Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Hàm thêm chi phí
    function addExpense() {
      const description = prompt("Nhập mô tả chi phí:");
      const amount = prompt("Nhập số tiền (₫):");
      if (description && amount) {
        database.ref('expenses').push({
          description: description,
          amount: parseInt(amount),
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => updateSummary()).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Hàm thêm xuất hàng
    function addShipment() {
      const product = prompt("Nhập sản phẩm:");
      const quantity = prompt("Nhập số lượng:");
      const unit = prompt("Nhập đơn vị tính:");
      if (product && quantity && unit) {
        database.ref('shipments').push({
          product: product,
          quantity: parseInt(quantity),
          unit: unit,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => loadData('shipments')).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Hàm thêm doanh thu
    function addRevenue() {
      const description = prompt("Nhập mô tả doanh thu:");
      const amount = prompt("Nhập số tiền (₫):");
      if (description && amount) {
        database.ref('revenues').push({
          description: description,
          amount: parseInt(amount),
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => updateSummary()).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Hàm thêm sản phẩm vào kho
    function addProduct() {
      const name = prompt("Nhập tên sản phẩm:");
      const quantity = prompt("Nhập số lượng:");
      const unit = prompt("Nhập đơn vị tính:");
      const price = prompt("Nhập giá đơn vị (₫):");
      if (name && quantity && unit && price) {
        database.ref('inventory').push({
          name: name,
          quantity: parseInt(quantity),
          unit: unit,
          price: parseInt(price),
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => loadData('inventory')).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Hàm thêm người dùng
    function addUser() {
      const username = prompt("Nhập tên đăng nhập:");
      const role = prompt("Nhập vai trò (Nhân viên/Quản lý):");
      const status = prompt("Nhập trạng thái (Hoạt động/Không hoạt động):");
      if (username && role && status) {
        database.ref('users').push({
          username: username,
          role: role,
          status: status,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => loadData('users')).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Hàm tải và hiển thị dữ liệu
    function loadData(tableName) {
      const tables = {
        'shipments': '#shipmentsTable',
        'inventory': '#inventoryTable',
        'users': '#usersTable',
        'expenses': '#expensesTable',
        'revenues': '#revenuesTable'
      };
      if (tables[tableName]) {
        database.ref(tableName).on('value', (snapshot) => {
          const tbody = document.querySelector(tables[tableName] + ' tbody');
          tbody.innerHTML = '';
          snapshot.forEach((childSnapshot) => {
            const data = childSnapshot.val();
            const row = document.createElement('tr');
            let cols = '';
            if (tableName === 'shipments') cols = `<td>${data.product}</td><td>${data.quantity}</td><td>${data.unit}</td>`;
            else if (tableName === 'inventory') cols = `<td>${data.name}</td><td>${data.quantity}</td><td>${data.unit}</td><td>${data.price}₫</td>`;
            else if (tableName === 'users') cols = `<td>${data.username}</td><td>${data.role}</td><td>${data.status}</td>`;
            else if (tableName === 'expenses') cols = `<td>${data.description}</td><td>${data.amount}₫</td>`;
            else if (tableName === 'revenues') cols = `<td>${data.description}</td><td>${data.amount}₫</td>`;
            row.innerHTML = cols + `<td><button class="action-btn" onclick="deleteItem('${tableName}', '${childSnapshot.key}')">Xóa</button></td>`;
            tbody.appendChild(row);
          });
        });
      }
    }

    // Hàm xóa mục
    function deleteItem(tableName, key) {
      if (confirm("Bạn có chắc muốn xóa?")) {
        database.ref(tableName).child(key).remove().then(() => {
          alert("Xóa thành công!");
          if (tableName === 'expenses' || tableName === 'revenues') updateSummary();
          else loadData(tableName);
        }).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Hàm cập nhật tổng kết
    function updateSummary() {
      let totalExpense = 0;
      let totalRevenue = 0;

      database.ref('expenses').once('value').then((snapshot) => {
        snapshot.forEach((childSnapshot) => totalExpense += childSnapshot.val().amount || 0);
        database.ref('revenues').once('value').then((snapshot) => {
          snapshot.forEach((childSnapshot) => totalRevenue += childSnapshot.val().amount || 0);
          document.querySelector('#revenue').textContent = `Doanh thu: ${totalRevenue}₫`;
          document.querySelector('#expense').textContent = `Tổng chi phí: ${totalExpense}₫`;
          document.querySelector('#balance').textContent = `Số dư: ${totalRevenue - totalExpense}₫`;
        });
      });
    }

    // Hàm lưu ghi chú
    function saveNote() {
      const note = prompt("Nhập ghi chú cá nhân:");
      if (note) {
        database.ref('notes').push({
          content: note,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => alert("Lưu ghi chú thành công!")).catch((error) => alert("Lỗi: " + error.message));
      }
    }

    // Gắn sự kiện khi tải trang
    window.onload = () => {
      updateSummary();
      ['shipments', 'inventory', 'users', 'expenses', 'revenues'].forEach(loadData);
      document.querySelector('#addExpenseBtn').addEventListener('click', addExpense);
      document.querySelector('#addShipmentBtn').addEventListener('click', addShipment);
      document.querySelector('#addRevenueBtn').addEventListener('click', addRevenue);
      document.querySelector('#addProductBtn').addEventListener('click', addProduct);
      document.querySelector('#addUserBtn').addEventListener('click', addUser);
      document.querySelector('#saveNoteBtn').addEventListener('click', saveNote);
    };
  </script>
</head>
<body>
  <div class="nav">
    <h1>📊 Quản lý Kinh doanh</h1>
    <a href="#">Đăng xuất</a>
  </div>

  <div class="section">
    <h2>🔐 Đăng nhập</h2>
    <input type="text" placeholder="Tên đăng nhập"><br>
    <input type="password" placeholder="Mật khẩu"><br>
    <label><input type="checkbox"> Ghi nhớ đăng nhập</label><br>
    <button onclick="alert('Chức năng đăng nhập chưa được triển khai')">Đăng nhập</button>
    <p>Đang xác thực...</p>
  </div>

  <div class="section">
    <h2>💸 Chi phí</h2>
    <button id="addExpenseBtn">Thêm chi phí</button>
    <table>
      <thead><tr><th>Mô tả</th><th>Số tiền</th><th>Hành động</th></tr></thead>
      <tbody id="expensesTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>📦 Xuất hàng</h2>
    <button id="addShipmentBtn">Thêm xuất hàng</button>
    <table>
      <thead><tr><th>Sản phẩm</th><th>Số lượng</th><th>ĐVT</th><th>Hành động</th></tr></thead>
      <tbody id="shipmentsTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>💰 Doanh thu</h2>
    <button id="addRevenueBtn">Thêm doanh thu</button>
    <table>
      <thead><tr><th>Mô tả</th><th>Số tiền</th><th>Hành động</th></tr></thead>
      <tbody id="revenuesTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>📝 Tổng kết ngày</h2>
    <p id="revenue">Doanh thu: 0₫</p>
    <p id="expense">Tổng chi phí: 0₫</p>
    <p id="balance">Số dư: 0₫</p>
    <p>📌 Ghi chú cá nhân:</p>
    <button id="saveNoteBtn">💾 Lưu dữ liệu</button>
  </div>

  <div class="section">
    <h2>📦 Quản lý Kho hàng</h2>
    <button id="addProductBtn">➕ Thêm sản phẩm</button>
    <table>
      <thead><tr><th>Tên sản phẩm</th><th>Số lượng</th><th>ĐVT</th><th>Giá đơn vị</th><th>Hành động</th></tr></thead>
      <tbody id="inventoryTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>📊 Báo cáo</h2>
    <button onclick="alert('Chức năng báo cáo ngày chưa được triển khai')">📅 Báo cáo ngày</button>
    <button onclick="alert('Chức năng báo cáo tháng chưa được triển khai')">📆 Báo cáo tháng</button>
    <button onclick="alert('Chức năng in báo cáo chưa được triển khai')">🖨️ In báo cáo</button>
    <div class="filter">
      <select><option>Tất cả người dùng</option></select>
      <select><option>Tất cả danh mục</option></select>
      <button onclick="alert('Chức năng áp dụng chưa được triển khai')">🔍 Áp dụng</button>
    </div>
  </div>

  <div class="section">
    <h2>👥 Quản lý Người dùng</h2>
    <select>
      <option>Nhân viên</option>
      <option>Quản lý</option>
    </select>
    <button id="addUserBtn">➕ Thêm người dùng</button>
    <table>
      <thead><tr><th>Tên đăng nhập</th><th>Vai trò</th><th>Trạng thái</th><th>Hành động</th></tr></thead>
      <tbody id="usersTable"></tbody>
    </table>
  </div>
</body>
</html>
