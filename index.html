
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω Thi·∫øt B·ªã Y T·∫ø</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        
        /* Layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        
        /* Tabs */
        .tabs { display: flex; background: #34495e; border-radius: 5px; margin-bottom: 20px; }
        .tab { padding: 15px 20px; color: white; cursor: pointer; border-radius: 5px; }
        .tab.active { background: #3498db; }
        
        /* Cards & Grid */
        .card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .grid { display: grid; gap: 20px; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        
        /* Form Elements */
        input, select, button { padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin: 5px; }
        button { background: #3498db; color: white; border: none; cursor: pointer; }
        button:hover { background: #2980b9; }
        
        /* Tables */
        .table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .table th { background: #34495e; color: white; }
        .table tr:hover { background: #f8f9fa; }
        
        /* Status Badges */
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; }
        .status-active { background: #d4edda; color: #155724; }
        .status-maintenance { background: #fff3cd; color: #856404; }
        .status-broken { background: #f8d7da; color: #721c24; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; }
        
        /* Search & Filter */
        .search-box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .filter-group { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè• H·ªÜ TH·ªêNG QU·∫¢N L√ù THI·∫æT B·ªä Y T·∫æ</h1>
            <p>Khoa G√¢y M√™ H·ªìi S·ª©c - B·ªánh vi·ªán T·ªânh Ninh Thu·∫≠n</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('import')">üì§ IMPORT EXCEL</div>
            <div class="tab" onclick="showTab('classify')">üè∑Ô∏è PH√ÇN LO·∫†I</div>
            <div class="tab" onclick="showTab('search')">üîç TRA C·ª®U</div>
            <div class="tab" onclick="showTab('dashboard')">üìä DASHBOARD</div>
        </div>

        <!-- Tab Contents -->
        <div id="import" class="tab-content">
            <!-- Excel Import Interface -->
        </div>

        <div id="classify" class="tab-content" style="display: none;">
            <!-- Classification Interface -->
        </div>

        <div id="search" class="tab-content" style="display: none;">
            <!-- Search Interface -->
        </div>

        <div id="dashboard" class="tab-content" style="display: none;">
            <!-- Dashboard Interface -->
        </div>
    </div>

    <!-- Device Detail Modal -->
    <div id="deviceModal" class="modal">
        <div class="modal-content">
            <!-- Device details will be loaded here -->
        </div>
    </div>

    <script>
        // ==================== GLOBAL DATA STORAGE ====================
        window.deviceManager = {
            devices: [],
            classifications: [],
            searchResults: [],
            
            // Classification options
            categories: [
                'D·ª•ng c·ª• ph·∫´u thu·∫≠t - K·ªÅm c√°c lo·∫°i',
                'D·ª•ng c·ª• ph·∫´u thu·∫≠t - K√©o ph·∫´u thu·∫≠t',
                'D·ª•ng c·ª• ph·∫´u thu·∫≠t - Banh m·ªï',
                'Thi·∫øt b·ªã h·ªó tr·ª£ - ƒê√®n c√°c lo·∫°i',
                'Thi·∫øt b·ªã h·ªó tr·ª£ - Xe ƒë·∫©y',
                'Thi·∫øt b·ªã h·ªó tr·ª£ - T·ªß, b√†n',
                'D·ª•ng c·ª• n·ªôi soi - ·ªêng soi',
                'D·ª•ng c·ª• n·ªôi soi - Trocar',
                'D·ª•ng c·ª• ti√™u hao - B√≥p b√≥ng',
                'D·ª•ng c·ª• ti√™u hao - ·ªêng nghe'
            ],
            
            departments: [
                'ƒê∆°n v·ªã Ph·∫´u thu·∫≠t - Ph√≤ng M·ªï 1',
                'ƒê∆°n v·ªã Ph·∫´u thu·∫≠t - Ph√≤ng M·ªï 2',
                'ƒê∆°n v·ªã H·ªìi s·ª©c - Khu HS t√≠ch c·ª±c',
                'ƒê∆°n v·ªã H·ªìi s·ª©c - Khu HS sau m·ªï',
                'ƒê∆°n v·ªã Gi·∫£m ƒëau - Ph√≤ng Ti√™m',
                'Kho d·ª± ph√≤ng'
            ],
            
            statuses: [
                'ƒêang s·ª≠ d·ª•ng',
                'B·∫£o tr√¨',
                'H∆∞ h·ªèng',
                'Thanh l√Ω',
                'D·ª± ph√≤ng'
            ],
            
            units: ['C√°i', 'B·ªô', 'Chi·∫øc', 'Set', 'B·ªô (l·∫ª)']
        };

        // ==================== UTILITY FUNCTIONS ====================
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).style.display = 'block';
            event.target.classList.add('active');
            
            // Load tab content
            loadTabContent(tabName);
        }

        function loadTabContent(tabName) {
            const contentMap = {
                'import': loadImportTab,
                'classify': loadClassificationTab,
                'search': loadSearchTab,
                'dashboard': loadDashboardTab
            };
            
            if (contentMap[tabName]) {
                contentMap[tabName]();
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND' 
            }).format(amount);
        }

        function getStatusBadge(status) {
            const badgeClass = {
                'ƒêang s·ª≠ d·ª•ng': 'status-active',
                'B·∫£o tr√¨': 'status-maintenance',
                'H∆∞ h·ªèng': 'status-broken',
                'Thanh l√Ω': 'status-broken',
                'D·ª± ph√≤ng': 'status-active'
            }[status] || 'status-active';
            
            return `<span class="badge ${badgeClass}">${status}</span>`;
        }

        function calculateDeviceAge(year) {
            return new Date().getFullYear() - year;
        }

        // ==================== IMPORT TAB ====================
        function loadImportTab() {
            document.getElementById('import').innerHTML = `
                <div class="card">
                    <h2>üì§ IMPORT D·ªÆ LI·ªÜU T·ª™ EXCEL</h2>
                    <div class="grid grid-2">
                        <div>
                            <h3>Upload File Excel</h3>
                            <input type="file" id="excelFile" accept=".xlsx, .xls">
                            <button onclick="parseExcelFile()">Parse Excel</button>
                        </div>
                        <div>
                            <h3>D·ªØ li·ªáu m·∫´u</h3>
                            <p>File Excel c·∫ßn c√≥ c√°c c·ªôt: T√™n c√¥ng c·ª• d·ª•ng c·ª•, NƒÉm s·∫£n xu·∫•t, S·ªë l∆∞·ª£ng, Nguy√™n gi√°</p>
                        </div>
                    </div>
                </div>
                
                <div id="excelPreview" class="card" style="display: none;">
                    <h3>üìã PREVIEW D·ªÆ LI·ªÜU</h3>
                    <div id="previewTable"></div>
                    <button onclick="confirmImport()" style="background: #27ae60;">X√ÅC NH·∫¨N IMPORT</button>
                </div>
            `;
        }

        function parseExcelFile() {
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Vui l√≤ng ch·ªçn file Excel');
                return;
            }

            // Simulate Excel parsing (in real app, use SheetJS)
            const sampleData = [
                {
                    ten_thiet_bi: 'K·ªÅm k·∫πp kim th·∫≥ng 20cm',
                    nam_san_xuat: 2019,
                    so_luong: 7,
                    nguyen_gia: 346500
                },
                {
                    ten_thiet_bi: 'B√†n Mayo',
                    nam_san_xuat: 1975,
                    so_luong: 15,
                    nguyen_gia: 1500000
                },
                {
                    ten_thiet_bi: 'ƒê√®n m·ªï ƒë·ª©ng 1 b√≥ng USA',
                    nam_san_xuat: 2007,
                    so_luong: 2,
                    nguyen_gia: 2183363
                },
                {
                    ten_thiet_bi: 'B√≥p b√≥ng s∆° sinh Silicon',
                    nam_san_xuat: 2021,
                    so_luong: 2,
                    nguyen_gia: 1785000
                },
                {
                    ten_thiet_bi: '·ªêng soi ni·ªáu qu·∫£n b·ªÉ th·∫≠n',
                    nam_san_xuat: 2025,
                    so_luong: 2,
                    nguyen_gia: 304160000
                }
            ];

            window.deviceManager.devices = sampleData.map((device, index) => ({
                id: index + 1,
                ...device,
                serial_number: `DC-${String(index + 1).padStart(3, '0')}`,
                phan_loai: '',
                don_vi_tinh: '',
                tinh_trang: 'ƒêang s·ª≠ d·ª•ng'
            }));

            displayExcelPreview();
        }

        function displayExcelPreview() {
            const previewDiv = document.getElementById('excelPreview');
            const tableDiv = document.getElementById('previewTable');
            
            let html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>T√™n thi·∫øt b·ªã</th>
                            <th>NƒÉm SX</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>Nguy√™n gi√°</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            window.deviceManager.devices.forEach(device => {
                html += `
                    <tr>
                        <td>${device.id}</td>
                        <td>${device.ten_thiet_bi}</td>
                        <td>${device.nam_san_xuat}</td>
                        <td>${device.so_luong}</td>
                        <td>${formatCurrency(device.nguyen_gia)}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            tableDiv.innerHTML = html;
            previewDiv.style.display = 'block';
        }

        function confirmImport() {
            alert(`ƒê√£ import th√†nh c√¥ng ${window.deviceManager.devices.length} thi·∫øt b·ªã!`);
            showTab('classify');
        }

        // ==================== CLASSIFICATION TAB ====================
        function loadClassificationTab() {
            if (window.deviceManager.devices.length === 0) {
                document.getElementById('classify').innerHTML = `
                    <div class="card">
                        <h2>üìù PH√ÇN LO·∫†I THI·∫æT B·ªä</h2>
                        <p>Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng import Excel tr∆∞·ªõc.</p>
                        <button onclick="showTab('import')">QUAY L·∫†I IMPORT</button>
                    </div>
                `;
                return;
            }

            document.getElementById('classify').innerHTML = `
                <div class="card">
                    <h2>üè∑Ô∏è PH√ÇN LO·∫†I THI·∫æT B·ªä</h2>
                    <p>T·ªïng s·ªë thi·∫øt b·ªã: ${window.deviceManager.devices.length}</p>
                    
                    <div class="filter-group">
                        <input type="text" id="searchClassify" placeholder="T√¨m thi·∫øt b·ªã..." onkeyup="filterClassificationTable()">
                        <select id="filterStatus" onchange="filterClassificationTable()">
                            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            ${window.deviceManager.statuses.map(status => 
                                `<option value="${status}">${status}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div id="classificationTable"></div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="saveAllClassifications()" style="background: #27ae60;">üíæ L∆ØU T·∫§T C·∫¢ PH√ÇN LO·∫†I</button>
                        <button onclick="autoClassifyAll()">ü§ñ PH√ÇN LO·∫†I T·ª∞ ƒê·ªòNG</button>
                    </div>
                </div>
            `;

            renderClassificationTable();
        }

        function renderClassificationTable() {
            const tableDiv = document.getElementById('classificationTable');
            let html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>T√™n thi·∫øt b·ªã</th>
                            <th>Ph√¢n lo·∫°i</th>
                            <th>ƒê∆°n v·ªã</th>
                            <th>Ph√≤ng ban</th>
                            <th>T√¨nh tr·∫°ng</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            window.deviceManager.devices.forEach(device => {
                html += `
                    <tr>
                        <td>${device.id}</td>
                        <td>
                            <strong>${device.ten_thiet_bi}</strong>
                            <br><small>${device.serial_number}</small>
                        </td>
                        <td>
                            <select id="category_${device.id}" onchange="updateDeviceClassification(${device.id})">
                                <option value="">-- Ch·ªçn ph√¢n lo·∫°i --</option>
                                ${window.deviceManager.categories.map(cat => 
                                    `<option value="${cat}" ${device.phan_loai === cat ? 'selected' : ''}>${cat}</option>`
                                ).join('')}
                            </select>
                        </td>
                        <td>
                            <select id="unit_${device.id}" onchange="updateDeviceClassification(${device.id})">
                                <option value="">-- ƒê∆°n v·ªã --</option>
                                ${window.deviceManager.units.map(unit => 
                                    `<option value="${unit}" ${device.don_vi_tinh === unit ? 'selected' : ''}>${unit}</option>`
                                ).join('')}
                            </select>
                        </td>
                        <td>
                            <select id="department_${device.id}" onchange="updateDeviceClassification(${device.id})">
                                <option value="">-- Ph√≤ng ban --</option>
                                ${window.deviceManager.departments.map(dept => 
                                    `<option value="${dept}" ${device.phong_ban === dept ? 'selected' : ''}>${dept}</option>`
                                ).join('')}
                            </select>
                        </td>
                        <td>
                            <select id="status_${device.id}" onchange="updateDeviceClassification(${device.id})">
                                ${window.deviceManager.statuses.map(status => 
                                    `<option value="${status}" ${device.tinh_trang === status ? 'selected' : ''}>${status}</option>`
                                ).join('')}
                            </select>
                        </td>
                        <td>
                            <button onclick="viewDeviceDetail(${device.id})" style="padding: 5px 10px;">üëÅÔ∏è Xem</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            tableDiv.innerHTML = html;
        }

        function updateDeviceClassification(deviceId) {
            const device = window.deviceManager.devices.find(d => d.id === deviceId);
            if (device) {
                device.phan_loai = document.getElementById(`category_${deviceId}`).value;
                device.don_vi_tinh = document.getElementById(`unit_${deviceId}`).value;
                device.phong_ban = document.getElementById(`department_${deviceId}`).value;
                device.tinh_trang = document.getElementById(`status_${deviceId}`).value;
            }
        }

        function autoClassifyAll() {
            window.deviceManager.devices.forEach(device => {
                // Auto-classify based on device name keywords
                const name = device.ten_thiet_bi.toLowerCase();
                
                if (name.includes('k·ªÅm') || name.includes('k·∫πp')) {
                    device.phan_loai = 'D·ª•ng c·ª• ph·∫´u thu·∫≠t - K·ªÅm c√°c lo·∫°i';
                } else if (name.includes('b√†n') || name.includes('b√†n mayo')) {
                    device.phan_loai = 'Thi·∫øt b·ªã h·ªó tr·ª£ - T·ªß, b√†n';
                } else if (name.includes('ƒë√®n')) {
                    device.phan_loai = 'Thi·∫øt b·ªã h·ªó tr·ª£ - ƒê√®n c√°c lo·∫°i';
                } else if (name.includes('b√≥p b√≥ng')) {
                    device.phan_loai = 'D·ª•ng c·ª• ti√™u hao - B√≥p b√≥ng';
                } else if (name.includes('·ªëng soi')) {
                    device.phan_loai = 'D·ª•ng c·ª• n·ªôi soi - ·ªêng soi';
                }
                
                device.don_vi_tinh = 'C√°i';
                device.phong_ban = 'Kho d·ª± ph√≤ng';
            });
            
            renderClassificationTable();
            alert('ƒê√£ ph√¢n lo·∫°i t·ª± ƒë·ªông cho t·∫•t c·∫£ thi·∫øt b·ªã!');
        }

        function filterClassificationTable() {
            const searchTerm = document.getElementById('searchClassify').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            
            const rows = document.querySelectorAll('#classificationTable tbody tr');
            rows.forEach(row => {
                const deviceName = row.cells[1].textContent.toLowerCase();
                const deviceStatus = row.cells[5].querySelector('select').value;
                
                const nameMatch = deviceName.includes(searchTerm);
                const statusMatch = !statusFilter || deviceStatus === statusFilter;
                
                row.style.display = nameMatch && statusMatch ? '' : 'none';
            });
        }

        function saveAllClassifications() {
            const unclassified = window.deviceManager.devices.filter(d => !d.phan_loai);
            if (unclassified.length > 0) {
                if (!confirm(`C√≤n ${unclassified.length} thi·∫øt b·ªã ch∆∞a ƒë∆∞·ª£c ph√¢n lo·∫°i. Ti·∫øp t·ª•c l∆∞u?`)) {
                    return;
                }
            }
            
            localStorage.setItem('deviceClassifications', JSON.stringify(window.deviceManager.devices));
            alert('‚úÖ ƒê√£ l∆∞u t·∫•t c·∫£ ph√¢n lo·∫°i th√†nh c√¥ng!');
        }

        // ==================== SEARCH TAB ====================
        function loadSearchTab() {
            document.getElementById('search').innerHTML = `
                <div class="card">
                    <h2>üîç TRA C·ª®U THI·∫æT B·ªä</h2>
                    
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm theo t√™n, serial, model..." style="width: 300px;">
                        <button onclick="performSearch()">T√¨m ki·∫øm</button>
                        <button onclick="showAdvancedFilters()" style="background: #95a5a6;">üéõÔ∏è B·ªô l·ªçc n√¢ng cao</button>
                    </div>
                    
                    <div id="advancedFilters" style="display: none;">
                        <div class="grid grid-3">
                            <div>
                                <label>Ph√¢n lo·∫°i:</label>
                                <select id="filterCategory">
                                    <option value="">T·∫•t c·∫£ ph√¢n lo·∫°i</option>
                                    ${window.deviceManager.categories.map(cat => 
                                        `<option value="${cat}">${cat}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div>
                                <label>Ph√≤ng ban:</label>
                                <select id="filterDepartment">
                                    <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
                                    ${window.deviceManager.departments.map(dept => 
                                        `<option value="${dept}">${dept}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div>
                                <label>T√¨nh tr·∫°ng:</label>
                                <select id="filterStatusSearch">
                                    <option value="">T·∫•t c·∫£ t√¨nh tr·∫°ng</option>
                                    ${window.deviceManager.statuses.map(status => 
                                        `<option value="${status}">${status}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div>
                                <label>Tu·ªïi thi·∫øt b·ªã:</label>
                                <select id="filterAge">
                                    <option value="">T·∫•t c·∫£ tu·ªïi</option>
                                    <option value="5">D∆∞·ªõi 5 nƒÉm</option>
                                    <option value="10">5-10 nƒÉm</option>
                                    <option value="15">10-15 nƒÉm</option>
                                    <option value="20">Tr√™n 15 nƒÉm</option>
                                </select>
                            </div>
                            <div>
                                <label>Gi√° tr·ªã:</label>
                                <select id="filterPrice">
                                    <option value="">T·∫•t c·∫£ gi√°</option>
                                    <option value="1000000">D∆∞·ªõi 1 tri·ªáu</option>
                                    <option value="10000000">1-10 tri·ªáu</option>
                                    <option value="100000000">10-100 tri·ªáu</option>
                                    <option value="1000000000">Tr√™n 100 tri·ªáu</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="searchResults" style="margin-top: 20px;"></div>
                </div>
            `;
        }

        function showAdvancedFilters() {
            const filters = document.getElementById('advancedFilters');
            filters.style.display = filters.style.display === 'none' ? 'block' : 'none';
        }

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('filterCategory').value;
            const departmentFilter = document.getElementById('filterDepartment').value;
            const statusFilter = document.getElementById('filterStatusSearch').value;
            const ageFilter = document.getElementById('filterAge').value;
            const priceFilter = document.getElementById('filterPrice').value;
            
            let results = window.deviceManager.devices.filter(device => {
                // Text search
                const textMatch = !searchTerm || 
                    device.ten_thiet_bi.toLowerCase().includes(searchTerm) ||
                    device.serial_number.toLowerCase().includes(searchTerm);
                
                // Category filter
                const categoryMatch = !categoryFilter || device.phan_loai === categoryFilter;
                
                // Department filter
                const departmentMatch = !departmentFilter || device.phong_ban === departmentFilter;
                
                // Status filter
                const statusMatch = !statusFilter || device.tinh_trang === statusFilter;
                
                // Age filter
                const deviceAge = calculateDeviceAge(device.nam_san_xuat);
                const ageMatch = !ageFilter || (
                    ageFilter === '5' ? deviceAge < 5 :
                    ageFilter === '10' ? deviceAge >= 5 && deviceAge <= 10 :
                    ageFilter === '15' ? deviceAge > 10 && deviceAge <= 15 :
                    deviceAge > 15
                );
                
                // Price filter
                const priceMatch = !priceFilter || (
                    priceFilter === '1000000' ? device.nguyen_gia < 1000000 :
                    priceFilter === '10000000' ? device.nguyen_gia >= 1000000 && device.nguyen_gia < 10000000 :
                    priceFilter === '100000000' ? device.nguyen_gia >= 10000000 && device.nguyen_gia < 100000000 :
                    device.nguyen_gia >= 100000000
                );
                
                return textMatch && categoryMatch && departmentMatch && statusMatch && ageMatch && priceMatch;
            });
            
            displaySearchResults(results);
        }

        function displaySearchResults(results) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p>Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã n√†o ph√π h·ª£p.</p>';
                return;
            }
            
            let html = `
                <h3>üìä K·∫æT QU·∫¢ T√åM KI·∫æM: ${results.length} thi·∫øt b·ªã</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Thi·∫øt b·ªã</th>
                            <th>Serial</th>
                            <th>Ph√¢n lo·∫°i</th>
                            <th>Ph√≤ng ban</th>
                            <th>T√¨nh tr·∫°ng</th>
                            <th>Tu·ªïi</th>
                            <th>Gi√° tr·ªã</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            results.forEach(device => {
                const age = calculateDeviceAge(device.nam_san_xuat);
                html += `
                    <tr>
                        <td>${device.id}</td>
                        <td><strong>${device.ten_thiet_bi}</strong></td>
                        <td>${device.serial_number}</td>
                        <td>${device.phan_loai || 'Ch∆∞a ph√¢n lo·∫°i'}</td>
                        <td>${device.phong_ban || 'Ch∆∞a ph√¢n b·ªï'}</td>
                        <td>${getStatusBadge(device.tinh_trang)}</td>
                        <td>${age} nƒÉm</td>
                        <td>${formatCurrency(device.nguyen_gia)}</td>
                        <td>
                            <button onclick="viewDeviceDetail(${device.id})">üëÅÔ∏è Chi ti·∫øt</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            resultsDiv.innerHTML = html;
        }

        // ==================== DEVICE DETAIL MODAL ====================
        function viewDeviceDetail(deviceId) {
            const device = window.deviceManager.devices.find(d => d.id === deviceId);
            if (!device) return;
            
            const modal = document.getElementById('deviceModal');
            const modalContent = modal.querySelector('.modal-content');
            
            const age = calculateDeviceAge(device.nam_san_xuat);
            const ageStatus = age < 5 ? 'M·ªõi' : age < 10 ? 'Trung b√¨nh' : 'C≈©';
            
            modalContent.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 20px;">
                    <h2>${device.ten_thiet_bi}</h2>
                    <button onclick="closeModal()" style="background: #e74c3c; padding: 5px 10px;">‚úï ƒê√≥ng</button>
                </div>
                
                <div class="grid grid-2">
                    <div>
                        <h3>üìã TH√îNG TIN C∆† B·∫¢N</h3>
                        <table style="width: 100%;">
                            <tr><td><strong>Serial:</strong></td><td>${device.serial_number}</td></tr>
                            <tr><td><strong>NƒÉm SX:</strong></td><td>${device.nam_san_xuat}</td></tr>
                            <tr><td><strong>Tu·ªïi:</strong></td><td>${age} nƒÉm (${ageStatus})</td></tr>
                            <tr><td><strong>Nguy√™n gi√°:</strong></td><td>${formatCurrency(device.nguyen_gia)}</td></tr>
                            <tr><td><strong>S·ªë l∆∞·ª£ng:</strong></td><td>${device.so_luong}</td></tr>
                        </table>
                    </div>
                    
                    <div>
                        <h3>üè∑Ô∏è PH√ÇN LO·∫†I & TR·∫†NG TH√ÅI</h3>
                        <table style="width: 100%;">
                            <tr><td><strong>Ph√¢n lo·∫°i:</strong></td><td>${device.phan_loai || 'Ch∆∞a ph√¢n lo·∫°i'}</td></tr>
                            <tr><td><strong>ƒê∆°n v·ªã t√≠nh:</strong></td><td>${device.don_vi_tinh || 'Ch∆∞a x√°c ƒë·ªãnh'}</td></tr>
                            <tr><td><strong>Ph√≤ng ban:</strong></td><td>${device.phong_ban || 'Ch∆∞a ph√¢n b·ªï'}</td></tr>
                            <tr><td><strong>T√¨nh tr·∫°ng:</strong></td><td>${getStatusBadge(device.tinh_trang)}</td></tr>
                        </table>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>üìä TH·ªêNG K√ä S·ª¨ D·ª§NG</h3>
                    <div class="grid grid-3">
                        <div style="text-align: center; padding: 10px; background: #ecf0f1; border-radius: 5px;">
                            <div style="font-size: 24px;">${age}</div>
                            <div>NƒÉm tu·ªïi</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #ecf0f1; border-radius: 5px;">
                            <div style="font-size: 24px;">${device.so_luong}</div>
                            <div>S·ªë l∆∞·ª£ng</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #ecf0f1; border-radius: 5px;">
                            <div style="font-size: 24px;">${formatCurrency(device.nguyen_gia)}</div>
                            <div>Gi√° tr·ªã</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button onclick="editDevice(${device.id})" style="background: #f39c12;">‚úèÔ∏è Ch·ªânh s·ª≠a</button>
                    <button onclick="generateQRCode(${device.id})" style="background: #9b59b6;">üì± QR Code</button>
                    <button onclick="exportDeviceReport(${device.id})" style="background: #27ae60;">üìÑ Xu·∫•t b√°o c√°o</button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('deviceModal').style.display = 'none';
        }

        function editDevice(deviceId) {
            alert(`Chuy·ªÉn sang ch·∫ø ƒë·ªô ch·ªânh s·ª≠a cho thi·∫øt b·ªã ${deviceId}`);
            // Implementation for edit functionality
        }

        function generateQRCode(deviceId) {
            alert(`T·∫°o QR Code cho thi·∫øt b·ªã ${deviceId}`);
            // Implementation for QR code generation
        }

        function exportDeviceReport(deviceId) {
            alert(`Xu·∫•t b√°o c√°o cho thi·∫øt b·ªã ${deviceId}`);
            // Implementation for report export
        }

        // ==================== DASHBOARD TAB ====================
        function loadDashboardTab() {
            const devices = window.deviceManager.devices;
            const totalDevices = devices.length;
            const classifiedDevices = devices.filter(d => d.phan_loai).length;
            const activeDevices = devices.filter(d => d.tinh_trang === 'ƒêang s·ª≠ d·ª•ng').length;
            
            // Calculate statistics
            const statusCount = {};
            const categoryCount = {};
            const departmentCount = {};
            const ageGroups = { '0-5': 0, '5-10': 0, '10-15': 0, '15+': 0 };
            
            devices.forEach(device => {
                // Status count
                statusCount[device.tinh_trang] = (statusCount[device.tinh_trang] || 0) + 1;
                
                // Category count
                if (device.phan_loai) {
                    categoryCount[device.phan_loai] = (categoryCount[device.phan_loai] || 0) + 1;
                }
                
                // Department count
                if (device.phong_ban) {
                    departmentCount[device.phong_ban] = (departmentCount[device.phong_ban] || 0) + 1;
                }
                
                // Age groups
                const age = calculateDeviceAge(device.nam_san_xuat);
                if (age <= 5) ageGroups['0-5']++;
                else if (age <= 10) ageGroups['5-10']++;
                else if (age <= 15) ageGroups['10-15']++;
                else ageGroups['15+']++;
            });

            document.getElementById('dashboard').innerHTML = `
                <div class="card">
                    <h2>üìä DASHBOARD T·ªîNG QUAN</h2>
                    
                    <div class="grid grid-3">
                        <div style="text-align: center; padding: 20px; background: #3498db; color: white; border-radius: 10px;">
                            <div style="font-size: 32px;">${totalDevices}</div>
                            <div>T·ªïng thi·∫øt b·ªã</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #27ae60; color: white; border-radius: 10px;">
                            <div style="font-size: 32px;">${classifiedDevices}</div>
                            <div>ƒê√£ ph√¢n lo·∫°i</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #e74c3c; color: white; border-radius: 10px;">
                            <div style="font-size: 32px;">${activeDevices}</div>
                            <div>ƒêang s·ª≠ d·ª•ng</div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üìà PH√ÇN B·ªê THEO T√åNH TR·∫†NG</h3>
                        <div id="statusChart">
                            ${Object.entries(statusCount).map(([status, count]) => `
                                <div style="margin: 10px 0;">
                                    <div style="display: flex; justify-content: between;">
                                        <span>${status}</span>
                                        <span>${count}</span>
                                    </div>
                                    <div style="background: #ecf0f1; height: 10px; border-radius: 5px;">
                                        <div style="background: #3498db; height: 100%; width: ${(count/totalDevices)*100}%; border-radius: 5px;"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>üìä PH√ÇN B·ªê THEO TU·ªîI</h3>
                        <div id="ageChart">
                            ${Object.entries(ageGroups).map(([ageGroup, count]) => `
                                <div style="margin: 10px 0;">
                                    <div style="display: flex; justify-content: between;">
                                        <span>${ageGroup} nƒÉm</span>
                                        <span>${count}</span>
                                    </div>
                                    <div style="background: #ecf0f1; height: 10px; border-radius: 5px;">
                                        <div style="background: #e74c3c; height: 100%; width: ${(count/totalDevices)*100}%; border-radius: 5px;"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üö® C·∫¢NH B√ÅO & ƒê·ªÄ XU·∫§T</h3>
                    <div id="alerts">
                        ${devices.filter(d => calculateDeviceAge(d.nam_san_xuat) > 15).length > 0 ? `
                            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 5px 0;">
                                ‚ö†Ô∏è C√≥ ${devices.filter(d => calculateDeviceAge(d.nam_san_xuat) > 15).length} thi·∫øt b·ªã tr√™n 15 nƒÉm tu·ªïi c·∫ßn xem x√©t thay th·∫ø
                            </div>
                        ` : ''}
                        
                        ${devices.filter(d => d.tinh_trang === 'H∆∞ h·ªèng').length > 0 ? `
                            <div style="background: #f8d7da; padding: 10px; border-radius: 5px; margin: 5px 0;">
                                ‚ùå C√≥ ${devices.filter(d => d.tinh_trang === 'H∆∞ h·ªèng').length} thi·∫øt b·ªã h∆∞ h·ªèng c·∫ßn s·ª≠a ch·ªØa
                            </div>
                        ` : ''}
                        
                        ${devices.filter(d => !d.phan_loai).length > 0 ? `
                            <div style="background: #d1ecf1; padding: 10px; border-radius: 5px; margin: 5px 0;">
                                ‚ÑπÔ∏è C√≥ ${devices.filter(d => !d.phan_loai).length} thi·∫øt b·ªã ch∆∞a ƒë∆∞·ª£c ph√¢n lo·∫°i
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ==================== INITIALIZATION ====================
        window.onload = function() {
            // Load saved data from localStorage
            const savedData = localStorage.getItem('deviceClassifications');
            if (savedData) {
                window.deviceManager.devices = JSON.parse(savedData);
            }
            
            // Show initial tab
            loadTabContent('import');
        };

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('deviceModal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>
