
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản Lý Nhân Viên</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div id="login-page" class="min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded shadow-md w-full max-w-md">
      <h2 class="text-2xl font-bold mb-6 text-center">Đăng Nhập</h2>
      <input id="email" type="email" placeholder="Email" class="w-full p-2 mb-4 border rounded">
      <input id="password" type="password" placeholder="Mật khẩu" class="w-full p-2 mb-4 border rounded">
      <button onclick="login()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Đăng Nhập</button>
      <p id="error" class="text-red-500 text-center mt-4 hidden"></p>
    </div>
  </div>

  <div id="employee-page" class="hidden p-8">
    <h2 class="text-2xl font-bold mb-6">Báo Cáo Nhân Viên</h2>
    <div class="grid grid-cols-1 gap-4">
      <div>
        <label class="block">Chi Phí</label>
        <input id="cost" type="number" class="w-full p-2 border rounded">
      </div>
      <div>
        <label class="block">Doanh Thu</label>
        <input id="revenue" type="number" class="w-full p-2 border rounded">
      </div>
      <div>
        <label class="block">Xuất Hàng</label>
        <input id="export" type="number" class="w-full p-2 border rounded">
      </div>
      <button onclick="submitReport()" class="bg-green-500 text-white p-2 rounded hover:bg-green-600">Gửi Báo Cáo</button>
    </div>
  </div>

  <div id="manager-page" class="hidden p-8">
    <h2 class="text-2xl font-bold mb-6">Quản Lý</h2>
    <div class="mb-6">
      <h3 class="text-xl font-semibold">Nhập Kho</h3>
      <input id="stock" type="number" placeholder="Số lượng nhập kho" class="w-full p-2 border rounded mb-2">
      <button onclick="addStock()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Nhập Kho</button>
    </div>
    <div>
      <h3 class="text-xl font-semibold">Báo Cáo Nhân Viên</h3>
      <div id="reports" class="mt-4"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDmFpKa8TpDjo3pQADaTubgVpDPOi-FPXk",
      authDomain: "quanly-d7e54.firebaseapp.com",
      databaseURL: "https://quanly-d7e54-default-rtdb.firebaseio.com",
      projectId: "quanly-d7e54",
      storageBucket: "quanly-d7e54.firebasestorage.app",
      messagingSenderId: "482686011267",
      appId: "1:482686011267:web:f2fe9d400fe618487a98b6"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          console.log('User UID:', user.uid); // In UID để kiểm tra
          checkUserRole(user.uid);
        })
        .catch(error => {
          document.getElementById('error').textContent = 'Lỗi đăng nhập: ' + error.message;
          document.getElementById('error').classList.remove('hidden');
        });
    }

    function checkUserRole(uid) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const userData = snapshot.val();
        if (userData && userData.role === 'manager') {
          document.getElementById('login-page').classList.add('hidden');
          document.getElementById('manager-page').classList.remove('hidden');
          loadReports();
        } else {
          document.getElementById('login-page').classList.add('hidden');
          document.getElementById('employee-page').classList.remove('hidden');
        }
      }).catch(error => {
        console.error('Lỗi kiểm tra vai trò:', error);
        alert('Lỗi kiểm tra vai trò: ' + error.message);
      });
    }

    function submitReport() {
      const cost = document.getElementById('cost').value;
      const revenue = document.getElementById('revenue').value;
      const exportQty = document.getElementById('export').value;
      const user = auth.currentUser;

      if (!user) {
        alert('Vui lòng đăng nhập để gửi báo cáo!');
        return;
      }

      if (!cost || !revenue || !exportQty) {
        alert('Vui lòng nhập đầy đủ thông tin báo cáo!');
        return;
      }

      db.ref('reports/' + user.uid).push({
        cost: parseFloat(cost),
        revenue: parseFloat(revenue),
        export: parseFloat(exportQty),
        timestamp: new Date().toISOString()
      }).then(() => {
        alert('Báo cáo đã được gửi!');
        document.getElementById('cost').value = '';
        document.getElementById('revenue').value = '';
        document.getElementById('export').value = '';
      }).catch(error => {
        console.error('Lỗi gửi báo cáo:', error);
        alert('Lỗi gửi báo cáo: ' + error.message);
      });
    }

    function addStock() {
      const stock = document.getElementById('stock').value;
      const user = auth.currentUser;

      if (!user) {
        alert('Vui lòng đăng nhập để nhập kho!');
        return;
      }

      if (!stock) {
        alert('Vui lòng nhập số lượng nhập kho!');
        return;
      }

      db.ref('stock').push({
        quantity: parseFloat(stock),
        timestamp: new Date().toISOString()
      }).then(() => {
        alert('Đã nhập kho!');
        document.getElementById('stock').value = '';
      }).catch(error => {
        console.error('Lỗi nhập kho:', error);
        alert('Lỗi nhập kho: ' + error.message);
      });
    }

    function loadReports() {
      db.ref('reports').on('value', snapshot => {
        const reportsDiv = document.getElementById('reports');
        reportsDiv.innerHTML = '';
        snapshot.forEach(userSnapshot => {
          const userId = userSnapshot.key;
          const reports = userSnapshot.val();
          for (let reportId in reports) {
            const report = reports[reportId];
            const reportDiv = document.createElement('div');
            reportDiv.className = 'border p-4 mb-2 rounded';
            reportDiv.innerHTML = `
              <p><strong>User ID:</strong> ${userId}</p>
              <p><strong>Chi Phí:</strong> ${report.cost}</p>
              <p><strong>Doanh Thu:</strong> ${report.revenue}</p>
              <p><strong>Xuất Hàng:</strong> ${report.export}</p>
              <p><strong>Thời Gian:</strong> ${report.timestamp}</p>
            `;
            reportsDiv.appendChild(reportDiv);
          }
        });
      }, error => {
        console.error('Lỗi tải báo cáo:', error);
        alert('Lỗi tải báo cáo: ' + error.message);
      });
    }
  </script>
</body>
</html>
